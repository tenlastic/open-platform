<ten-sidenav>
  <div class="content">
    <app-group-messages *ngIf="$activeGroup | async as group" [group]="group"></app-group-messages>
    <app-messages *ngIf="$activeUser | async as user" [user]="user"></app-messages>
    <router-outlet></router-outlet>
  </div>

  <div *ngIf="identityService.user" class="nav">
    <ng-container *ngIf="!($group | async)">
      <div *ngIf="$groupInvitation | async as groupInvitation" class="group-invitation">
        <div class="hover-off">
          <mat-icon>person_add</mat-icon>
          <div class="label">
            <div class="name">Group Invitation</div>
            <div class="status">From {{ groupInvitation.fromUser.username }}</div>
          </div>
        </div>

        <div class="hover-on">
          <ten-button color="accent" (OnClick)="rejectGroupInvitation()">Reject</ten-button>
          <ten-button color="primary" (OnClick)="acceptGroupInvitation()">Accept</ten-button>
        </div>
      </div>
    </ng-container>

    <ten-button
      *ngIf="($group | async) === undefined"
      color="accent"
      layout="vertical"
      text="left"
      width="full"
      (OnClick)="newGroup()"
    >
      <mat-icon>group_add</mat-icon>
      <span>Start Group</span>
    </ten-button>

    <ten-button
      *ngIf="$group | async as group"
      class="online"
      color="accent"
      layout="vertical"
      text="left"
      width="full"
      [ngClass]="{ active: ($activeGroup | async)?._id === group._id }"
      (OnClick)="setGroup(group)"
    >
      <mat-icon>people</mat-icon>
      <div class="label">
        <div class="name">Group</div>
        <div class="status">
          {{ group.userIds.length }} Member{{ group.userIds.length > 1 ? 's' : '' }}
        </div>
      </div>
      <span *ngIf="$getUnreadGroupMessagesCount(group._id) | async" class="badge">
        {{ $getUnreadGroupMessagesCount(group._id) | async }}
      </span>
    </ten-button>

    <ten-button color="accent" layout="vertical" text="left" width="full" (OnClick)="newMessage()">
      <mat-icon>add</mat-icon>
      <span>New Direct Message</span>
    </ten-button>

    <app-message-group
      *ngIf="$group | async as group"
      header="Group"
      [isVisible]="true"
      [showGroup]="false"
      [users]="group.users | truthy"
    ></app-message-group>

    <app-message-group
      *ngIf="($friends | async).length"
      header="Friends"
      [isVisible]="true"
      [users]="$friends | async | select: 'toUser' | truthy"
    ></app-message-group>

    <app-message-group
      *ngIf="conversations.length"
      header="Other Conversations"
      [users]="conversations | select: 'user' | truthy"
    ></app-message-group>
  </div>
</ten-sidenav>
