<div class="page">
  <app-title>Edit Game Information</app-title>

  <form *ngIf="form"
        [formGroup]="form"
        autocomplete="off">
    <div class="row">
      <div class="col-sm-3">
        <mat-form-field floatLabel="always">
          <mat-label>Title</mat-label>
          <input matInput
                 required
                 formControlName="title" />
          <mat-error>Enter a valid title.</mat-error>
        </mat-form-field>
      </div>

      <div class="col-sm-3">
        <mat-form-field floatLabel="always">
          <mat-label>Subtitle</mat-label>
          <input matInput
                 formControlName="subtitle" />
          <mat-error>Enter a valid subtitle.</mat-error>
        </mat-form-field>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-6">
        <mat-form-field floatLabel="always"
                        width="full">
          <mat-label>Description</mat-label>
          <textarea matInput
                    cdkTextareaAutosize
                    required
                    formControlName="description"
                    type="text"></textarea>
          <mat-error>Enter a valid description.</mat-error>
        </mat-form-field>
      </div>
      <div *ngIf="form.get('description').value"
           class="col-sm-6">
        <mat-label>Description (Preview)</mat-label>
        <app-markdown [markdown]="form.get('description').value"></app-markdown>
      </div>
    </div>

    <div *ngFor="let error of errors"
         class="form-error">
      {{ error }}
    </div>

    <app-button color="primary"
                (click)="save()">Save</app-button>
    <app-button color="accent"
                routerLink="../">Cancel</app-button>

    <app-toggle-section *ngIf="data._id"
                        isVisible="true"
                        title="Background Image">
      <mat-grid-list *ngIf="data.background || pending['background'].length"
                     cols="4"
                     gutterSize="8"
                     rowHeight="1920:1080">
        <mat-grid-tile *ngIf="data.background"
                       [ngStyle]="{ 'background-image': 'url(' + data.background + ')' }">
          <app-button color="accent"
                      (OnClick)="view(data.background)">
            <mat-icon>fullscreen</mat-icon>
            <span>View</span>
          </app-button>
        </mat-grid-tile>

        <mat-grid-tile *ngIf="!data.background"
                       class="pending">
          <mat-spinner [diameter]="30"></mat-spinner>
        </mat-grid-tile>
      </mat-grid-list>

      <input #backgroundInput
             accept=".jpg,.jpeg,.png"
             hidden
             type="file"
             (change)="onFieldChanged($event, 'background')" />

      <div *ngFor="let error of uploadErrors['background']"
           class="form-error">
        {{ error }}
      </div>

      <app-button color="primary"
                  (OnClick)="backgroundInput.click()">Browse</app-button>
      <app-button *ngIf="data.background"
                  color="accent"
                  (OnClick)="remove('background')">Remove</app-button>
    </app-toggle-section>

    <app-toggle-section *ngIf="data._id"
                        isVisible="true"
                        title="Icon Image">
      <mat-grid-list *ngIf="data.icon || pending['icon'].length"
                     cols="4"
                     gutterSize="8"
                     rowHeight="1920:1080">
        <mat-grid-tile *ngIf="data.icon"
                       class="icon"
                       [ngStyle]="{ 'background-image': 'url(' + data.icon + ')' }">
        </mat-grid-tile>

        <mat-grid-tile *ngIf="!data.icon"
                       class="pending">
          <mat-spinner [diameter]="30"></mat-spinner>
        </mat-grid-tile>
      </mat-grid-list>

      <input #iconInput
             accept=".jpg,.jpeg,.png"
             hidden
             type="file"
             (change)="onFieldChanged($event, 'icon')" />

      <div *ngFor="let error of uploadErrors['icon']"
           class="form-error">
        {{ error }}
      </div>

      <app-button color="primary"
                  (OnClick)="iconInput.click()">Browse</app-button>
      <app-button *ngIf="data.icon"
                  color="accent"
                  (OnClick)="remove('icon')">Remove</app-button>
    </app-toggle-section>

    <app-toggle-section *ngIf="data._id"
                        isVisible="true"
                        title="Images">
      <mat-grid-list *ngIf="data.images && data.images.length || pending['images'].length"
                     cols="4"
                     gutterSize="8"
                     rowHeight="1920:1080">
        <mat-grid-tile *ngFor="let image of data.images; let i = index"
                       [ngStyle]="{ 'background-image': 'url(' + image + ')' }">
          <app-button color="accent"
                      (OnClick)="view(image)">
            <mat-icon>fullscreen</mat-icon>
            <span>View</span>
          </app-button>
          <app-button color="accent"
                      (OnClick)="remove('images', i)">
            <mat-icon>close</mat-icon>
            <span>Remove</span>
          </app-button>
        </mat-grid-tile>

        <mat-grid-tile *ngFor="let image of pending['images']"
                       class="pending">
          <mat-spinner [diameter]="30"></mat-spinner>
        </mat-grid-tile>
      </mat-grid-list>

      <input #imagesInput
             accept=".jpg,.jpeg,.png"
             hidden
             multiple="true"
             type="file"
             (change)="onFieldChanged($event, 'images')" />

      <div *ngFor="let error of uploadErrors['images']"
           class="form-error">
        {{ error }}
      </div>

      <app-button color="primary"
                  (OnClick)="imagesInput.click()">Browse</app-button>
    </app-toggle-section>

    <app-toggle-section *ngIf="data._id"
                        isVisible="true"
                        title="Videos">
      <mat-grid-list *ngIf="data.videos && data.videos.length || pending['videos'].length"
                     cols="4"
                     gutterSize="8"
                     rowHeight="1920:1080">
        <mat-grid-tile *ngFor="let video of data.videos; let i = index">
          <video>
            <source [src]="video"
                    type="video/mp4" />
          </video>
          <app-button color="accent"
                      (OnClick)="view(video, 'video')">
            <mat-icon>fullscreen</mat-icon>
            <span>View</span>
          </app-button>
          <app-button color="accent"
                      (OnClick)="remove('videos', i)">
            <mat-icon>close</mat-icon>
            <span>Remove</span>
          </app-button>
        </mat-grid-tile>

        <mat-grid-tile *ngFor="let image of pending['videos']"
                       class="pending">
          <mat-spinner [diameter]="30"></mat-spinner>
        </mat-grid-tile>
      </mat-grid-list>

      <input #videosInput
             accept=".mp4"
             hidden
             multiple="true"
             type="file"
             (change)="onFieldChanged($event, 'videos')" />

      <div *ngFor="let error of uploadErrors['videos']"
           class="form-error">
        {{ error }}
      </div>

      <app-button color="primary"
                  (OnClick)="videosInput.click()">Browse</app-button>
    </app-toggle-section>
  </form>
</div>
